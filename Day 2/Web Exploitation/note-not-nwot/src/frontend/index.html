<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Note Not Nwot?</title>
    <style>
        body {
            font-family: Arial, sans-serif;
        }
        .menu {
            background-color: #333;
            overflow: hidden;
        }
        .menu a {
            float: left;
            display: block;
            color: white;
            text-align: center;
            padding: 14px 20px;
            text-decoration: none;
            cursor: pointer;
        }
        .menu a:hover {
            background-color: #575757;
        }
        .submenu {
            display: none;
            position: absolute;
            background-color: #333;
            min-width: 160px;
            z-index: 1;
        }
        .menu .dropdown:hover .submenu {
            display: block;
        }
        .submenu a {
            float: none;
            color: white;
            padding: 12px 16px;
        }
        .submenu a:hover {
            background-color: #575757;
        }
        .dropdown {
            float: left;
            overflow: hidden;
        }
        .dropdown .dropbtn {
            cursor: pointer;
        }

        /* Hidden sections by default */
        .section {
            display: none;
        }

        /* Show the active section */
        .active {
            display: block;
        }

        /* Basic styling for the login form */
        .myform {
            max-width: 300px;
            margin: 20px auto;
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 5px;
            background-color: #f9f9f9;
        }
        .myform input[type="text"],
        .myform input[type="password"],
        .myform textarea {
            width: 100%;
            padding: 10px;
            margin: 8px 0;
            display: inline-block;
            border: 1px solid #ccc;
            border-radius: 4px;
            box-sizing: border-box;
        }
        .myform input[type="submit"] {
            width: 100%;
            background-color: #4CAF50;
            color: white;
            padding: 10px 15px;
            margin: 8px 0;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        .myform input[type="submit"]:hover {
            background-color: #45a049;
        }
    </style>
</head>
<body>

    <!-- Navigation Menu -->
    <div class="menu">
        <a onclick="showSection('login')">Login</a>
        <a onclick="showSection('register')">Register</a>

        <!-- Dropdown Menu for Notes -->
        <div class="dropdown">
            <a class="dropbtn">Notes</a>
            <div class="submenu">
                <a onclick="showSection('create-notes')">Create Notes</a>
                <a onclick="showSection('access-notes')">Access Notes</a>
            </div>
        </div>
    </div>

    <!-- Content Sections -->
    <div id="login" class="section">
        <h2>Login</h2>
        <form class="myform" id="loginForm">
            <label for="username">Username</label>
            <input type="text" id="username" name="username" placeholder="Enter your username" required>

            <label for="password">Password</label>
            <input type="password" id="password" name="password" placeholder="Enter your password" required>

            <input type="submit" value="Login">
        </form>
        <p id="loginMessage"></p>
    </div>

    <div id="register" class="section">
        <h2>Register</h2>
        <form class="myform" id="registerForm">
            <label for="username">Username</label>
            <input type="text" id="username" name="username" placeholder="Enter your username" required>

            <label for="password">Password</label>
            <input type="password" id="password" name="password" placeholder="Enter your password" required>

            <input type="submit" value="Register">
        </form>
        <p id="registerMessage"></p>
    </div>

    <div id="create-notes" class="section">
        <h2>Create Notes</h2>
        <form class="myform" id="createNoteForm">
          <label for="noteName">Name</label>
          <input type="text" id="noteName" name="name" placeholder="Enter note name" required>

          <label for="noteContent">Content</label>
          <textarea id="noteContent" name="content" placeholder="Enter note content" rows="6" required></textarea>

          <input type="submit" value="Create Note">
        </form>
        <p id="createNoteMessage"></p>
    </div>

    <div id="access-notes" class="section">
        <h2>Access Notes</h2>
        <form class="myform" id="accessNoteForm">
          <label for="noteName">Name</label>
          <input type="text" id="noteName" name="note" placeholder="Enter note name" required>
          <input type="submit" value="Access Note">
        </form>
        <p id="accessNoteMessage"></p>
    </div>

    <script>
        // Function to show the selected section and hide others
        function showSection(sectionId) {
            // Hide all sections
            var sections = document.getElementsByClassName('section');
            for (var i = 0; i < sections.length; i++) {
                sections[i].classList.remove('active');
            }

            // Show the clicked section
            var selectedSection = document.getElementById(sectionId);
            selectedSection.classList.add('active');
        }

        // Show the login section by default when the page loads
        window.onload = function() {
            showSection('login');
        };

        // Handle login form submission
        document.getElementById('loginForm').addEventListener('submit', function(event) {
            event.preventDefault(); // Prevent the default form submission behavior

            // Gather form data
            var formData = new URLSearchParams(new FormData(this)).toString();

            // Send the form data to the /api/login endpoint using Fetch API
            fetch('/api/login', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/x-www-form-urlencoded',
                },
                body: formData,
            })
            .then(response => response.json())
            .then(data => {
                if (data.access_token) {
                    // Store the access token in the local storage
                    localStorage.setItem('access_token', data.access_token);
                    document.getElementById('loginMessage').innerHTML = "Login successful!";
                } else {
                    document.getElementById('loginMessage').innerHTML = "Login failed: " + data.detail;
                }
            })
            .catch(error => {
                document.getElementById('loginMessage').innerHTML = "Error: " + error;
            });
        });

        // Handle register form submission
        document.getElementById('registerForm').addEventListener('submit', function(event) {
            event.preventDefault(); // Prevent the default form submission behavior

            // Gather form data
            var formData = new URLSearchParams(new FormData(this)).toString();

            // Send the form data to the /api/register endpoint using Fetch API
            fetch('/api/register', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/x-www-form-urlencoded',
                },
                body: formData,
            })
            .then(response => response.json())
            .then(data => {
              if (data.detail)
                document.getElementById('registerMessage').innerHTML = data.detail;
              else
                document.getElementById('registerMessage').innerHTML = data.message;
            })
            .catch(error => {
                document.getElementById('registerMessage').innerHTML = "Error: " + error;
            });
        });

        document.getElementById('createNoteForm').addEventListener('submit', function(event) {
            event.preventDefault(); // Prevent the default form submission behavior

            var formData = new URLSearchParams(new FormData(this)).toString();

            fetch('/api/notes', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/x-www-form-urlencoded',
                    'Authorization': 'Bearer '+ localStorage.getItem('access_token'),
                },
                body: formData,
            })
            .then(response => response.json())
            .then(data => {
              document.getElementById('createNoteMessage').innerHTML = data.message || data.detail;
            })
            .catch(error => {
                document.getElementById('createNoteMessage').innerHTML = "Error: " + error;
            });
        });

        document.getElementById('accessNoteForm').addEventListener('submit', function(event) {
            event.preventDefault(); // Prevent the default form submission behavior

            var formData = new URLSearchParams(new FormData(this)).toString();

            fetch('/api/notes?' + formData, {
                method: 'GET',
                headers: {
                    'Authorization': 'Bearer '+ localStorage.getItem('access_token'),
                }
            })
            .then(response => response.json())
            .then(data => {
              document.getElementById('accessNoteMessage').innerHTML = data.message || data.detail || data.content;
            })
            .catch(error => {
                document.getElementById('accessNoteMessage').innerHTML = "Error: " + error;
            });
        });
    </script>

</body>
</html>
